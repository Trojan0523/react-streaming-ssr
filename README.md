<!--
 * @Author: BuXiongYu
 * @Date: 2025-04-16 22:56:47
 * @LastEditors: BuXiongYu
 * @LastEditTime: 2025-04-16 23:01:05
 * @Description: æµå¼æ¸²æŸ“ SSR with security config
-->

# æµå¼æ¸²æŸ“ SSR with security config

ä¸€ä¸ªåŸºäº React Suspense çš„æµå¼æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰é¡¹ç›®ï¼Œé›†æˆäº†å®‰å…¨é…ç½®ï¼ˆCSPã€SRIï¼‰ã€‚

## ç‰¹æ€§

- âš¡ åŸºäº React 19 å’Œ Suspense çš„æµå¼ SSR å®ç°
- ğŸ”’ å†…ç½®å®‰å…¨ç­–ç•¥ï¼ˆCSPã€Script Nonceã€SRIï¼‰
- ğŸŒ æ”¯æŒå¤šç§æ”¯ä»˜ SDK é›†æˆï¼ˆStripeã€Klarnaã€PayPalï¼‰
- ğŸ”„ æ¸è¿›å¼åŠ è½½ä½“éªŒï¼Œéª¨æ¶å±ä¼˜å…ˆæ¸²æŸ“
- ğŸ’» å¼€å‘ç¯å¢ƒå®æ—¶çƒ­åŠ è½½
- ğŸš€ ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
npm install
```

### å¼€å‘ç¯å¢ƒ

```bash
npm run dev
```

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
npm run build
```

### é¢„è§ˆç”Ÿäº§ç‰ˆæœ¬

```bash
npm run preview
```

## é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ public/              # é™æ€èµ„æºç›®å½•
â”‚   â””â”€â”€ _react_streaming.js  # æµå¼æ¸²æŸ“çš„å®¢æˆ·ç«¯è„šæœ¬
â”œâ”€â”€ server/              # æœåŠ¡å™¨é…ç½®
â”‚   â””â”€â”€ middlewares/     # Express ä¸­é—´ä»¶
â”‚       â””â”€â”€ script-nonce.middleware.ts  # CSP å’Œ Nonce å®‰å…¨é…ç½®
â”œâ”€â”€ src/                 # æºä»£ç 
â”‚   â”œâ”€â”€ components/      # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Comments.tsx    # ä½¿ç”¨ Suspense çš„å»¶è¿ŸåŠ è½½ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Layout.tsx      # é¡µé¢å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Post.tsx        # ä¸»å†…å®¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Skeleton.tsx    # éª¨æ¶å±ç»„ä»¶
â”‚   â”‚   â””â”€â”€ Spinner.tsx     # åŠ è½½æŒ‡ç¤ºå™¨
â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ sri/         # SRI (Subresource Integrity) ç›¸å…³å·¥å…·
â”‚   â”œâ”€â”€ App.tsx          # åº”ç”¨ä¸»ç»„ä»¶
â”‚   â””â”€â”€ entry-server.tsx # SSR å…¥å£ç‚¹
â”œâ”€â”€ server.ts            # Express æœåŠ¡å™¨
â”œâ”€â”€ index.html           # HTML æ¨¡æ¿
â””â”€â”€ vite.config.ts       # Vite é…ç½®
```

## å®‰å…¨ç‰¹æ€§

- **å†…å®¹å®‰å…¨ç­–ç•¥ (CSP)**: é€šè¿‡ Helmet å®ç°ï¼Œé™åˆ¶åŠ è½½çš„èµ„æºæ¥æº
- **Script Nonce**: ä¸ºè„šæœ¬æ·»åŠ éšæœºç”Ÿæˆçš„ nonce å€¼ï¼Œå¢å¼º CSP çš„å®‰å…¨æ€§
- **å­èµ„æºå®Œæ•´æ€§ (SRI)**: é€šè¿‡ hash éªŒè¯ç¬¬ä¸‰æ–¹è„šæœ¬çš„å®Œæ•´æ€§

## æµå¼æ¸²æŸ“å¦‚ä½•å·¥ä½œ

1. æœåŠ¡å™¨å¿«é€Ÿæ¸²æŸ“å¹¶å‘é€åˆå§‹ HTMLï¼ˆå¸¦éª¨æ¶å±ï¼‰
2. å®¢æˆ·ç«¯æ¥æ”¶å¹¶ç«‹å³æ˜¾ç¤ºéª¨æ¶å±
3. Suspense ç»„ä»¶å¼‚æ­¥åŠ è½½å†…å®¹
4. æ•°æ®åŠ è½½å®Œæˆåï¼ŒæœåŠ¡å™¨æµå¼å‘é€å®Œæ•´å†…å®¹
5. å®¢æˆ·ç«¯æ— éœ€åˆ·æ–°ï¼Œå¹³æ»‘æ›´æ–°ç•Œé¢

## TODO

- [ ] tanstack route æ¥å…¥
- [ ] 
- [ ] 
- [ ] 
- [ ] 
- [ ] 
- [ ] 